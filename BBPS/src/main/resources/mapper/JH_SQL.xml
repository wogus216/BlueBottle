<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="JH"><!-- namespace: 클래스명과동일 -->
	
	<!-- 본사로그인 -->
	<select id="getHQ" parameterType="hashmap" resultType="hashmap">
		SELECT USER_NO,AUTH_NO,DEP_NO,ID,PW
		FROM HQ_USER
		WHERE ID = #{hId}
		AND PW = #{hPw}
	</select>
	
	<!-- 지점,포스로그인 -->
	<select id="getB" parameterType="hashmap" resultType="hashmap">
		SELECT BRCH_NO,ID,BRCH_NAME
		FROM BRCH
		WHERE ID = #{bId}
		AND PW = #{bPw}
	</select>
	
	
	<!-- 본사메뉴 -->
	<select id="getHMenu" parameterType="hashmap" resultType="hashmap">
		SELECT DISTINCT SM.SITE_MENU_NO,TOP_SITE_MENU_NO as TOP,SM.SITE_MENU_NAME,
		SM.ARR_SEQ,SM.DEPTH,SMA.AUTH_CODE,H.USER_NO,SM.SUB_MENU_FLAG AS sub
		FROM SITE_MENU SM INNER JOIN SITE_MENU_AUTH SMA
                          ON SM.SITE_MENU_NO = SMA.SITE_MENU_NO
                         AND SM.SITE_MENU_NO BETWEEN 1 AND 13
                         AND SMA.AUTH_CODE IN (1,2)
                  INNER JOIN HQ_USER H
                          ON H.AUTH_NO = SMA.AUTH_NO
        WHERE H.USER_NO = #{hUserNo}
		START WITH SM.DEPTH = #{hDt}
		CONNECT BY PRIOR SM.SITE_MENU_NO =SM.TOP_SITE_MENU_NO 
		ORDER BY SM.ARR_SEQ ASC
	</select>
	
	<!-- 메뉴 게시글 수 갖고오기 -->
	<select id="getMbCnt" parameterType="hashmap" resultType="Integer">
	SELECT COUNT(*) AS CNT
	FROM POS_MENU PM INNER JOIN POS_CATE PC
                        	 ON PM.POS_CATE_NO = PC.POS_CATE_NO
	WHERE 1 = 1
	<if test ="search_input !=null and search_input != ''">
		<choose>
			<when test="search_Filter == 0">
				AND PM.MENU_NAME LIKE '%' || #{search_input} || '%'
			</when>
			<when test="search_Filter == 1">
				AND PC.POS_CATE_NAME LIKE '%' || #{search_input} || '%'
			</when>
			<when test="search_Filter == 2">
				AND PM.MENU_PRICE LIKE '%' || #{search_input} || '%'
			</when>
		</choose>
	</if>
	</select>
	
	<!-- 메뉴 게시글 갖고오기 -->
	<select id="getMbList" parameterType="hashmap" resultType="hashmap">
		SELECT P.MENU_NO,P.MENU_NAME,P.CNAME,P.MENU_PRICE,P.POS_CATE_NO
		FROM (SELECT PM.MENU_NO,PM.MENU_NAME,PM.POS_CATE_NO,PM.MENU_PRICE,PC.POS_CATE_NAME as CNAME,
		             ROW_NUMBER() OVER( ORDER BY MENU_NO ASC) AS RNUM
		      FROM POS_MENU PM INNER JOIN POS_CATE PC
		                                 ON PM.POS_CATE_NO = PC.POS_CATE_NO
		WHERE 1=1
	<if test ="search_input !=null and search_input != ''">
		<choose>
			<when test="search_Filter == 0">
				AND PM.MENU_NAME LIKE '%' || #{search_input} || '%'
			</when>
			<when test="search_Filter == 1">
				AND PC.POS_CATE_NAME LIKE'%' || #{search_input} || '%'
			</when>
			<when test="search_Filter == 2">
				AND PM.MENU_PRICE LIKE '%' || #{search_input} || '%'
			</when>
		</choose>
	</if>
	<if test ="cateNo !=null and cateNo != ''">
		<choose>
			<when test="cateNo == 0">
				AND PM.POS_CATE_NO =  #{cateNo}
			</when>
			<when test="cateNo == 1">
				AND  PM.POS_CATE_NO =  #{cateNo}
			</when>
			<when test="cateNo == 2">
				AND PM.POS_CATE_NO  =  #{cateNo}
			</when>
			<when test="cateNo == 3">
				AND PM.POS_CATE_NO =  #{cateNo}
			</when>
			<when test="cateNo == 4">
				AND PM.POS_CATE_NO =  #{cateNo}
			</when>
		</choose>
	</if>
	   ) P
	   WHERE P.RNUM BETWEEN #{startCnt} AND #{endCnt}
	</select>
	
	<!-- 상세보기 -->
	<select id="getMd" parameterType="hashmap" resultType="hashmap">
	SELECT  PM.MENU_NO AS MNO,PM.MENU_NAME AS MNAME,PC.POS_CATE_NAME AS CNAME,PM.MENU_PRICE AS MPRICE,PM.MENU_IMG AS MIMG,PM.NOTE
	FROM POS_MENU PM INNER JOIN POS_CATE PC
                         ON PM.POS_CATE_NO = PC.POS_CATE_NO
	WHERE PM.MENU_NO = #{menuNo}	
	</select>
	
	<!-- 수정 -->
	<update id="editM" parameterType="hashmap">
		UPDATE POS_MENU SET MENU_PRICE = #{m_Price}, NOTE = #{m_Note}
		WHERE MENU_NO = #{menuNo}
	</update>
	
	<!-- 등록  -->
	<insert id="addM" parameterType="hashmap">
		INSERT INTO POS_MENU (MENU_NO,MENU_NAME,POS_CATE_NO,USER_NO,MENU_PRICE,MENU_IMG)
		VALUES (POS_MENU_SEQ.NEXTVAL,#{m_Name},#{m_Cate},#{userNo},#{m_Price},#{m_File})
	</insert>
	
</mapper> 