<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="JH"><!-- namespace: 클래스명과동일 -->
	
	<!-- 본사로그인 -->
	<select id="getHQ" parameterType="hashmap" resultType="hashmap">
		SELECT USER_NO,AUTH_NO,DEP_NO,ID,PW
		FROM HQ_USER
		WHERE ID = #{hId}
		AND PW = #{hPw}
	</select>
	
	<!-- 지점,포스로그인 -->
	<select id="getB" parameterType="hashmap" resultType="hashmap">
		SELECT BRCH_NO,ID,BRCH_NAME
		FROM BRCH
		WHERE ID = #{bId}
		AND PW = #{bPw}
	</select>
	
	
	<!-- 본사메뉴 -->
	<select id="getHMenu" parameterType="hashmap" resultType="hashmap">
		SELECT DISTINCT SM.SITE_MENU_NO,SM.TOP_SITE_MENU_NO as TOP,SM.SITE_MENU_NAME,
			SM.ARR_SEQ,SM.DEPTH,SMA.AUTH_CODE,A.AUTH_NO,SM.SUB_MENU_FLAG AS sub,SM.MENU_ADDR AS MADDR
		FROM SITE_MENU SM INNER JOIN SITE_MENU_AUTH SMA
                          ON SM.SITE_MENU_NO = SMA.SITE_MENU_NO
                         AND SM.SITE_MENU_NO BETWEEN 1 AND 13
                         AND SMA.AUTH_CODE IN (1,2)
                  INNER JOIN AUTH A
                          ON A.AUTH_NO = SMA.AUTH_NO
        WHERE A.AUTH_NO = #{hAuthNo}
		START WITH SM.DEPTH = #{hDt}
		CONNECT BY PRIOR SM.SITE_MENU_NO =SM.TOP_SITE_MENU_NO 
		ORDER BY SM.ARR_SEQ ASC
	</select>
	
	
	<!-- 메뉴 게시글 수 갖고오기 -->
	<select id="getMbCnt" parameterType="hashmap" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM POS_MENU PM INNER JOIN POS_CATE PC
	                        	 ON PM.POS_CATE_NO = PC.CATE_NO
		WHERE 1 = 1 AND PM.DEL_FLAG = 1
	<if test ="search_input !=null and search_input != ''">
		<choose>
			<when test="search_Filter == 0">
				AND PM.MENU_NAME LIKE '%' || #{search_input} || '%'
			</when>
			<when test="search_Filter == 1">
				AND PC.CATE_NAME LIKE '%' || #{search_input} || '%'
			</when>
			<when test="search_Filter == 2">
				AND PM.MENU_PRICE LIKE '%' || #{search_input} || '%'
			</when>
		</choose>
	</if>
	</select>
	
	<!-- 메뉴 게시글 갖고오기 -->
	<select id="getMbList" parameterType="hashmap" resultType="hashmap">
		SELECT P.MENU_NO,P.MENU_NAME,P.CNAME,P.MENU_PRICE,P.POS_CATE_NO,P.NOTE,P.MENU_IMG
		FROM (SELECT PM.MENU_NO,PM.MENU_NAME,PM.POS_CATE_NO,PM.MENU_PRICE,PM.MENU_IMG,PC.CATE_NAME as CNAME,PM.NOTE,
		             ROW_NUMBER() OVER( ORDER BY MENU_NO ASC) AS RNUM
		      FROM POS_MENU PM INNER JOIN POS_CATE PC
		                                 ON PM.POS_CATE_NO = PC.CATE_NO
		WHERE 1=1 
		AND PM.DEL_FLAG = 1
	<if test ="search_input !=null and search_input != ''">
		<choose>
			<when test="search_Filter == 0">
				AND PM.MENU_NAME LIKE '%' || #{search_input} || '%'
			</when>
			<when test="search_Filter == 1">
				AND PC.CATE_NAME LIKE'%' || #{search_input} || '%'
			</when>
			<when test="search_Filter == 2">
				AND PM.MENU_PRICE LIKE '%' || #{search_input} || '%'
			</when>
		</choose>
	</if>
	<if test ="cateNo !=null and cateNo != ''">
		<choose>
			<when test="cateNo == 0">
				AND PM.POS_CATE_NO =  #{cateNo}
			</when>
			<when test="cateNo == 1">
				AND  PM.POS_CATE_NO =  #{cateNo}
			</when>
			<when test="cateNo == 2">
				AND PM.POS_CATE_NO  =  #{cateNo}
			</when>
			<when test="cateNo == 3">
				AND PM.POS_CATE_NO =  #{cateNo}
			</when>
			<when test="cateNo == 4">
				AND PM.POS_CATE_NO =  #{cateNo}
			</when>
		</choose>
	</if>
	   ) P
	   WHERE P.RNUM BETWEEN #{startCnt} AND #{endCnt}
	</select>
	
	<!-- 상세보기 -->
	<select id="getMd" parameterType="hashmap" resultType="hashmap">
	SELECT  PM.MENU_NO AS MNO, PM.MENU_NAME AS MNAME, PC.CATE_NAME AS CNAME, PM.MENU_PRICE AS MPRICE, PM.MENU_IMG AS MIMG, PM.NOTE
	FROM POS_MENU PM INNER JOIN POS_CATE PC
                         ON PM.POS_CATE_NO = PC.CATE_NO
	WHERE PM.MENU_NO = #{menuNo}	
	</select>
	
	<!-- 수정 -->
	<update id="editM" parameterType="hashmap">
		UPDATE POS_MENU SET MENU_NAME = #{m_name}, MENU_PRICE = #{m_price}, MENU_IMG = #{m_file}, NOTE = #{m_note}
		WHERE MENU_NO = #{menuNo}
	</update>
	
	<!-- 등록  -->
	<insert id="addM" parameterType="hashmap">
		INSERT INTO POS_MENU (MENU_NO,MENU_NAME,POS_CATE_NO,USER_NO,MENU_PRICE,MENU_IMG,NOTE)
		VALUES (POS_MENU_SEQ.NEXTVAL,#{m_name},#{m_cate},#{userNo},#{m_price},#{m_file},#{m_Note})
	</insert>
	
	<!-- 수정 -->
	<update id="delM" parameterType="hashmap">
		UPDATE POS_MENU SET DEL_FLAG = 0
		WHERE MENU_NO = #{menuNo}
	</update>
	
	<!-- 지점메뉴 -->
	<select id="getBMenu" parameterType="hashmap" resultType="hashmap">
		SELECT DISTINCT SM.SITE_MENU_NO,SM.TOP_SITE_MENU_NO AS TOP,SM.SITE_MENU_NAME,SM.ARR_SEQ,SM.DEPTH,SMA.AUTH_CODE,A.AUTH_NO,SM.SUB_MENU_FLAG as sub,SM.MENU_ADDR AS MADDR
		FROM SITE_MENU SM INNER JOIN SITE_MENU_AUTH SMA
		                          ON SM.SITE_MENU_NO = SMA.SITE_MENU_NO
		                         AND SM.SITE_MENU_NO BETWEEN 14 AND 24
		                         AND SMA.AUTH_CODE IN (1,2)
		                  INNER JOIN AUTH A
		                          ON A.AUTH_NO = SMA.AUTH_NO
        WHERE A.AUTH_NO = 6
		START WITH SM.DEPTH = #{bDt}
		CONNECT BY PRIOR SM.SITE_MENU_NO =SM.TOP_SITE_MENU_NO 
		ORDER BY SM.SITE_MENU_NO ASC
	</select>
	
	<!--포스 갖고오기 -->
	<select id="getPMenu" parameterType="hashmap" resultType="hashmap">
		SELECT M.MNO,M.CNO,M.MNAME,M.MIMG,M.MPRICE
		FROM (SELECT MENU_NO AS MNO,POS_CATE_NO AS CNO, MENU_NAME AS MNAME,MENU_IMG AS MIMG, MENU_PRICE AS MPRICE,
                ROW_NUMBER() OVER ( ORDER BY MENU_NO DESC)
     		  FROM POS_MENU
      	WHERE 1 = 1 
      	AND DEL_FLAG = 1
	<if test ="cateNo !=null and cateNo != ''">
		<choose>
			<when test="cateNo == 0">
				AND POS_CATE_NO =  #{cateNo}
			</when>
			<when test="cateNo == 1">
				AND  POS_CATE_NO =  #{cateNo}
			</when>
			<when test="cateNo == 2">
				AND POS_CATE_NO  =  #{cateNo}
			</when>
			<when test="cateNo == 3">
				AND POS_CATE_NO =  #{cateNo}
			</when>
		</choose>
	</if>
     	) M
	</select>
	
	<!-- 오더메뉴 -->
	<select id="getMOrd" parameterType="hashmap" resultType="hashmap">
		SELECT  PM.MENU_NO AS MNO, PM.MENU_NAME AS MNAME, PC.CATE_NAME AS CNAME, PM.MENU_PRICE AS MPRICE, PM.MENU_IMG AS MIMG,PC.CATE_NO AS CNO
		FROM POS_MENU PM INNER JOIN POS_CATE PC
	                         ON PM.POS_CATE_NO = PC.CATE_NO
		WHERE PM.MENU_NO = #{menuNo}
	</select>
	
	<!-- 오더 품목 넣기 -->
	<insert id="addOrd" parameterType="hashmap">
		INSERT INTO SALES_MENU(SALES_NO,MENU_NO,CNT)
		VALUES (210703020006, #{oMNo}, #{oMCnt})
	</insert>
	
</mapper> 