<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SG">
<select id="getNCnt" parameterType="hashmap" resultType="Integer">
	SELECT COUNT(*) AS CNT
	FROM NOTICE N INNER JOIN HQ_USER U
	ON N.USER_NO = U.USER_NO
	WHERE 1=1
	<if test="searchTxt != null and searchTxt != ''">
	<choose>
		<when test="searchGbn == 0">
		AND TITLE LIKE '%' || #{searchTxt} || '%'
		OR CONTENT LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 1">
		AND TITLE LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 2">
		AND CONTENT LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 3">
		AND USER_NAME LIKE '%' || #{searchTxt} || '%'
		</when>
	</choose>
</if>
</select>


<select id ="getNList" parameterType="hashmap" resultType="hashmap">
SELECT N.TXT_NO, N.TITLE, N.S_DT, N.USER_NAME
FROM(SELECT TXT_NO, TITLE, TO_CHAR(WRITE_DATE, 'YYYY/MM/DD') AS S_DT,H.USER_NAME
        , ROW_NUMBER() OVER(ORDER BY TXT_NO DESC) AS RNUM
    FROM NOTICE O INNER JOIN HQ_USER H
                          ON O.USER_NO = H.USER_NO
WHERE 1=1
<if test="searchTxt != null and searchTxt != ''"> 
	<choose>
		<when test="searchGbn == 0">
		AND TITLE LIKE '%' || #{searchTxt} || '%'
		OR CONTENT LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 1">
		AND TITLE LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 2">
		AND CONTENT LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 3">
		AND USER_NAME LIKE '%' || #{searchTxt} || '%'
		</when>
	</choose>
</if>
)N
WHERE N.RNUM BETWEEN #{startCnt} AND #{endCnt}
</select>

<insert id="addN" parameterType="hashmap">
INSERT INTO NOTICE(TXT_NO, CATE_NO, USER_NO, TITLE, CONTENT)
VALUES(NOTICE_SEQ.NEXTVAL, #{nCate}, 4, #{nTitle}, #{nCon})
</insert>

<select id="getN" parameterType="hashmap" resultType="hashmap">
SELECT TXT_NO, TITLE, CONTENT, TO_CHAR(WRITE_DATE, 'YYYY-MM-DD') AS S_DT, 
	ATT_FILE, SUBSTR(ATT_FILE, 21) AS ATT_UFILE, H.USER_NAME AS USER_NAME
FROM NOTICE N INNER JOIN HQ_USER H
ON N.USER_NO = H.USER_NO
WHERE TXT_NO = #{nNo}
</select>

<update id="updateN" parameterType="hashmap">
UPDATE NOTICE SET TITLE = #{nTitle}, CONTENT = #{nCon}
WHERE TXT_NO = #{nNo}
</update>

<delete id="deleteN" parameterType="hashmap">
DELETE FROM NOTICE
WHERE TXT_NO = #{nNo}
</delete>









<select id="getUCnt" parameterType="hashmap" resultType="Integer">
SELECT COUNT(*) AS CNT
FROM(SELECT U.USER_NO AS USER_NO, D.DEP_NAME AS NAME, USER_NAME, ID 
FROM HQ_USER U INNER JOIN HQ_DEP D
ON U.DEP_NO = D.DEP_NO
UNION ALL
SELECT BRCH_NO AS USER_NO, BRCH_NAME AS NAME, MGR_NAME AS USER_NAME, ID 
FROM BRCH) C
WHERE 1=1
	<if test="searchTxt != null and searchTxt != ''">
	<choose>
		<when test="searchGbn == 0">
    	AND USER_NO LIKE '%' || #{searchTxt} || '%'
    	OR NAME LIKE '%' || #{searchTxt} || '%'
    	OR USER_NAME LIKE '%' || #{searchTxt} || '%'
    	OR ID  LIKE '%' || #{searchTxt} || '%'
    	</when>
    	<when test="searchGbn == 1">
    	AND USER_NO LIKE '%' || #{searchTxt} || '%'
    	</when>
    	<when test="searchGbn == 2">
    	AND NAME LIKE '%' || #{searchTxt} || '%'
    	</when>
    	<when test="searchGbn == 3">
    	AND USER_NAME LIKE '%' || #{searchTxt} || '%'
    	</when>
    	<when test="searchGbn == 4">
    	AND ID LIKE '%' || #{searchTxt} || '%'
    	</when>
	</choose>
</if>
</select>




<select id ="getUList" parameterType="hashmap" resultType="hashmap">
SELECT U.USER_NO, U.NAME, U.USER_NAME, U.ID, U.DIVI
FROM(SELECT U.USER_NO AS USER_NO, U.NAME AS NAME, U.USER_NAME AS USER_NAME, U.ID AS ID, 
        ROW_NUMBER() OVER(ORDER BY U.USER_NO DESC) AS RNUM, U.DIVI AS DIVI
     FROM(SELECT U.USER_NO AS USER_NO, D.DEP_NAME AS NAME, U.USER_NAME AS USER_NAME, U.ID AS ID, U.DIVISION AS DIVI
          FROM  HQ_DEP D INNER JOIN HQ_USER U
                                 ON D.DEP_NO = U.DEP_NO
          UNION
          SELECT BRCH_NO AS USER_NO, BRCH_NAME AS NAME, MGR_NAME AS USER_NAME, ID, DIVISION AS DIVI
          FROM BRCH) U
    WHERE 1=1
    <if test="searchTxt != null and searchTxt != ''"> 
	<choose>
		<when test="searchGbn == 0">
    	AND USER_NO LIKE '%' || #{searchTxt} || '%'
    	OR NAME LIKE '%' || #{searchTxt} || '%'
    	OR USER_NAME LIKE '%' || #{searchTxt} || '%'
    	OR ID  LIKE '%' || #{searchTxt} || '%'
    	
    	</when>
    	<when test="searchGbn == 1">
    	AND USER_NO LIKE '%' || #{searchTxt} || '%'
    	</when>
    	<when test="searchGbn == 2">
    	AND NAME LIKE '%' || #{searchTxt} || '%'
    	</when>
    	<when test="searchGbn == 3">
    	AND USER_NAME LIKE '%' || #{searchTxt} || '%'
    	</when>
    	<when test="searchGbn == 4">
    	AND ID LIKE '%' || #{searchTxt} || '%'
    	</when>
    	</choose>
	</if>
	 <if test="cateNo != null and cateNo != ''"> 
	<choose>
		<when test="cateNo == 0">
    	AND DIVI = #{cateNo}
    	</when>
    	<when test="cateNo == 1">
    	AND DIVI = #{cateNo}
    	</when>
    	<when test="cateNo == 2">
    	AND DIVI IN (0,1)
    	</when>
    	</choose>
		</if>
)U
WHERE U.RNUM BETWEEN #{startCnt} AND #{endCnt}
</select>

<insert id="addU" parameterType="hashmap">
INSERT INTO HQ_USER
(USER_NO, AUTH_NO, DEP_NO, ID, PW, USER_NAME, PHONE_NUM, ENROLL_DATE, DIVISION)
VALUES
(HQ_USER_SEQ.NEXTVAL, #{uAuto}, #{uDep}, #{uId}, #{uPw}, #{uNm}, #{uPhone}, SYSDATE, 0)
</insert>


<insert id="addB" parameterType="hashmap">
INSERT INTO BRCH
(BRCH_NO, ID, PW, BRCH_NAME, POST_NUM, DFT_ADDRESS, DTL_ADDRESS, CALL_NUM, MGR_NAME, MGR_PHONE_NUM, DIVISION)
VALUES
(BRCH_SEQ.NEXTVAL, #{bId}, #{bPw}, #{bNm}, #{bPost}, #{bDft}, #{bDtl}, #{bCall}, #{bMgrNm}, 1)
</insert>



<select id="getH" parameterType="hashmap" resultType="hashmap">
SELECT U.*
FROM (SELECT H.USER_NO, H.AUTH_NO, H.DEP_NO, D.DEP_NAME, H.ID, H.PW, H.USER_NAME, H.PHONE_NUM, H.ENROLL_DATE, H.DEL_DATE
      FROM HQ_USER H INNER JOIN HQ_DEP D
                             ON H.DEP_NO = D.DEP_NO) U
WHERE U.USER_NO IN #{uNo}
</select>
    
    
    
    
</mapper>