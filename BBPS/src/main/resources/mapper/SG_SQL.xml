<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SG">
<select id="getNCnt" parameterType="hashmap" resultType="Integer">
	SELECT COUNT(*) AS CNT
	FROM NOTICE
	WHERE 1=1
	<if test="searchTxt != null and searchTxt != ''">
	<choose>
		<when test="searchGbn == 0">
		AND ITEM_NAME LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 1">
		AND TITLE LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 2">
		AND CONTENT LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 3">
		AND USER_NO LIKE '%' || #{searchTxt} || '%'
		</when>
	</choose>
</if>
</select>


<select id ="getNList" parameterType="hashmap" resultType="hashmap">
SELECT N.TXT_NO, N.TITLE, N.S_DT, N.USER_NAME AS USER_NO
FROM(SELECT TXT_NO, TITLE, TO_CHAR(WRITE_DATE, 'YYYY/MM/DD') AS S_DT,H.USER_NAME
        , ROW_NUMBER() OVER(ORDER BY TXT_NO DESC) AS RNUM
    FROM NOTICE O INNER JOIN HQ_USER H
                          ON O.USER_NO = H.USER_NO
WHERE 1=1
<if test="searchTxt != null and searchTxt != ''"> 
	<choose>
		<when test="searchGbn == 0">
		AND TITLE LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 1">
		AND TITLE LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 2">
		AND CONTENT LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn == 3">
		AND USER_NO LIKE '%' || #{searchTxt} || '%'
		</when>
	</choose>
</if>
)N
WHERE N.RNUM BETWEEN #{startCnt} AND #{endCnt}
</select>

<insert id="addN" parameterType="hashmap">
INSERT INTO NOTICE(TXT_NO, CATE_NO, USER_NO, TITLE, CONTENT, ATT_FILE)
VALUES(NOTICE_SEQ.NEXTVAL, #{nCate}, #{nUser}, #{nTitle}, #{nCon}, #{nFile})
</insert>

<select id="getN" parameterType="hashmap" resultType="hashmap">
SELECT TITLE, B_WRITER, B_CON, TO_CHAR(WRITE_DT, 'YYYY-MM-DD') AS B_DT, 
	ATT_FILE, SUBSTR(B_FILE, 21) AS B_UFILE
FROM NOTICE
where TXT_NO = #{nNo}
</select>










</mapper>